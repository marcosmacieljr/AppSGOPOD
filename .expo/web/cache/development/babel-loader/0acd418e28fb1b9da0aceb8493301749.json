{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"C:\\\\RepositorioAPPSGO\\\\APP-main\\\\businessLayer\\\\forms.js\";\nimport React, { useState } from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport { httpRequest } from \"../utils/apiUtils\";\nimport * as constants from \"../utils/constants\";\nimport * as Permissions from 'expo-permissions';\nimport * as MediaLibrary from 'expo-media-library';\nimport * as FileSystem from 'expo-file-system';\nimport { getAssetId, setAssetId, getAlbumId, setAlbumId } from \"../db/sqliteConnection\";\nimport { newForm, deleteForm, selectForms, selectLastFormUser, newFormUser, selectFormUsers, getFormByRoute, deleteFormByRoute, selectLastWeather, newWeather, selectWeather, selectLastRestrictionReason, newRestrictionReason, selectRestrictionReason } from \"../db/forms\";\nimport { UserContext } from \"./login\";\nimport { ButtonP } from \"../components/Button\";\nimport { Message } from \"../components/AnimatedMessage\";\nexport function SendForm(props) {\n  var context = React.useContext(UserContext);\n\n  var _useState = useState(undefined),\n      _useState2 = _slicedToArray(_useState, 2),\n      message = _useState2[0],\n      setMessage = _useState2[1];\n\n  var sendFormApp = function sendFormApp(callback) {\n    var requiredField, response, responseDataString, msgRetornoSincronizacao;\n    return _regeneratorRuntime.async(function sendFormApp$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            requiredField = props.req(props.json);\n\n            if (!(requiredField == \"\")) {\n              _context.next = 27;\n              break;\n            }\n\n            _context.next = 4;\n            return _regeneratorRuntime.awrap(send(props.json, props.route, context.userId, props.createdForm));\n\n          case 4:\n            response = _context.sent;\n            responseDataString = response.data;\n            console.log(\"1:\" + responseDataString);\n            msgRetornoSincronizacao = \"Formulário salvo, porém, não sincronizado.\";\n\n            if (!(response.message == constants.timeoutMessage || response.message == constants.notConnectedMessage || response.data)) {\n              _context.next = 21;\n              break;\n            }\n\n            console.log(\"2:\" + responseDataString);\n            console.log(typeof responseDataString.includes === \"undefined\");\n\n            if (!(responseDataString != true && responseDataString != false)) {\n              _context.next = 18;\n              break;\n            }\n\n            if (!responseDataString.includes('sucesso')) {\n              _context.next = 18;\n              break;\n            }\n\n            _context.next = 15;\n            return _regeneratorRuntime.awrap(deleteFormByRoute(props.route));\n\n          case 15:\n            msgRetornoSincronizacao = responseDataString + \" Boletim sincronizado com sucesso!\";\n            _context.next = 18;\n            return _regeneratorRuntime.awrap(gravarLogLocal(getCurrentDate() + \" - \" + msgRetornoSincronizacao));\n\n          case 18:\n            props.callback();\n            _context.next = 25;\n            break;\n\n          case 21:\n            msgRetornoSincronizacao = \"\";\n            _context.next = 24;\n            return _regeneratorRuntime.awrap(gravarLogLocal(getCurrentDate() + \" - \" + response.message));\n\n          case 24:\n            setMessage(response.message);\n\n          case 25:\n            _context.next = 28;\n            break;\n\n          case 27:\n            setMessage(requiredField);\n\n          case 28:\n            if (!(msgRetornoSincronizacao != \"\" && msgRetornoSincronizacao != undefined)) {\n              _context.next = 32;\n              break;\n            }\n\n            _context.next = 31;\n            return _regeneratorRuntime.awrap(gravarLogLocal(getCurrentDate() + \" - \" + msgRetornoSincronizacao));\n\n          case 31:\n            alert(msgRetornoSincronizacao);\n\n          case 32:\n            callback();\n\n          case 33:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  return React.createElement(View, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 3\n    }\n  }, React.createElement(View, {\n    style: {\n      width: 400,\n      marginVertical: 20,\n      marginTop: 20,\n      alignItems: 'center',\n      width: '100%'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 4\n    }\n  }, React.createElement(ButtonP, {\n    title: props.title,\n    onPress: sendFormApp,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 5\n    }\n  })), React.createElement(Message, {\n    message: message,\n    callback: function callback() {\n      return setMessage(undefined);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 4\n    }\n  }));\n}\nexport var send = function send(json, route, userId, createdForm) {\n  var response, stringJSON, persistForm, _stringJSON, _persistForm;\n\n  return _regeneratorRuntime.async(function send$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.prev = 0;\n\n          if (!(userId && json.idBoletim != '')) {\n            _context2.next = 18;\n            break;\n          }\n\n          json.userId = userId;\n          _context2.next = 5;\n          return _regeneratorRuntime.awrap(httpRequest(json, route));\n\n        case 5:\n          response = _context2.sent;\n\n          if (response.data && !createdForm) {}\n\n          if (!(response.message == constants.timeoutMessage || response.message == constants.notConnectedMessage)) {\n            _context2.next = 14;\n            break;\n          }\n\n          _context2.next = 10;\n          return _regeneratorRuntime.awrap(JSON.stringify(json));\n\n        case 10:\n          stringJSON = _context2.sent;\n          _context2.next = 13;\n          return _regeneratorRuntime.awrap(newForm(stringJSON, route, createdForm));\n\n        case 13:\n          persistForm = _context2.sent;\n\n        case 14:\n          console.warn(response);\n          return _context2.abrupt(\"return\", response);\n\n        case 18:\n          _context2.next = 20;\n          return _regeneratorRuntime.awrap(JSON.stringify(json));\n\n        case 20:\n          _stringJSON = _context2.sent;\n          _context2.next = 23;\n          return _regeneratorRuntime.awrap(newForm(_stringJSON, route, createdForm));\n\n        case 23:\n          _persistForm = _context2.sent;\n          return _context2.abrupt(\"return\", {\n            data: _persistForm\n          });\n\n        case 25:\n          _context2.next = 31;\n          break;\n\n        case 27:\n          _context2.prev = 27;\n          _context2.t0 = _context2[\"catch\"](0);\n          console.log(_context2.t0);\n          return _context2.abrupt(\"return\", {\n            message: constants.errorMessage\n          });\n\n        case 31:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, null, null, [[0, 27]], Promise);\n};\nexport var syncApp = function syncApp(userId) {\n  var totalForms, syncForms, dbForms;\n  return _regeneratorRuntime.async(function syncApp$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          _context4.prev = 0;\n          totalForms = 0;\n          syncForms = 0;\n\n          if (!userId) {\n            _context4.next = 10;\n            break;\n          }\n\n          _context4.next = 6;\n          return _regeneratorRuntime.awrap(selectForms());\n\n        case 6:\n          dbForms = _context4.sent;\n          _context4.next = 9;\n          return _regeneratorRuntime.awrap(Promise.all(dbForms.map(function _callee(item) {\n            var jsonObject, response;\n            return _regeneratorRuntime.async(function _callee$(_context3) {\n              while (1) {\n                switch (_context3.prev = _context3.next) {\n                  case 0:\n                    _context3.next = 2;\n                    return _regeneratorRuntime.awrap(JSON.parse(item.stringJSON));\n\n                  case 2:\n                    jsonObject = _context3.sent;\n\n                    if (!(jsonObject.idBoletim != '')) {\n                      _context3.next = 9;\n                      break;\n                    }\n\n                    jsonObject.userId = userId;\n                    _context3.next = 7;\n                    return _regeneratorRuntime.awrap(httpRequest(jsonObject, item.route));\n\n                  case 7:\n                    response = _context3.sent;\n\n                    if (response.data) {\n                      deleteForm(item.id);\n                      syncForms += 1;\n                    }\n\n                  case 9:\n                    totalForms += 1;\n\n                  case 10:\n                  case \"end\":\n                    return _context3.stop();\n                }\n              }\n            }, null, null, null, Promise);\n          })));\n\n        case 9:\n          return _context4.abrupt(\"return\", {\n            message: syncForms + \" de \" + totalForms + \" formulários sincronizados\"\n          });\n\n        case 10:\n          _context4.next = 16;\n          break;\n\n        case 12:\n          _context4.prev = 12;\n          _context4.t0 = _context4[\"catch\"](0);\n          console.log(_context4.t0);\n          return _context4.abrupt(\"return\", {\n            message: constants.syncErrorMessage\n          });\n\n        case 16:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, null, null, [[0, 12]], Promise);\n};\nexport var updateForms = function updateForms(route) {\n  var toReturn, forms;\n  return _regeneratorRuntime.async(function updateForms$(_context5) {\n    while (1) {\n      switch (_context5.prev = _context5.next) {\n        case 0:\n          toReturn = null;\n          _context5.next = 3;\n          return _regeneratorRuntime.awrap(getFormByRoute(route));\n\n        case 3:\n          forms = _context5.sent;\n\n          if (forms.length > 0) {\n            toReturn = JSON.parse(forms[0].stringJSON);\n          }\n\n          return _context5.abrupt(\"return\", toReturn);\n\n        case 6:\n        case \"end\":\n          return _context5.stop();\n      }\n    }\n  }, null, null, null, Promise);\n};\nexport var syncFormUsers = function syncFormUsers() {\n  var idLastUserApi, requestJSON, response;\n  return _regeneratorRuntime.async(function syncFormUsers$(_context7) {\n    while (1) {\n      switch (_context7.prev = _context7.next) {\n        case 0:\n          _context7.next = 2;\n          return _regeneratorRuntime.awrap(selectLastFormUser());\n\n        case 2:\n          idLastUserApi = _context7.sent;\n          requestJSON = {\n            idLastUserApi: idLastUserApi\n          };\n          _context7.prev = 4;\n          _context7.next = 7;\n          return _regeneratorRuntime.awrap(httpRequest(requestJSON, constants.routes.consultaUsuarios));\n\n        case 7:\n          response = _context7.sent;\n\n          if (!response.data) {\n            _context7.next = 11;\n            break;\n          }\n\n          _context7.next = 11;\n          return _regeneratorRuntime.awrap(Promise.all(response.data.map(function _callee2(item) {\n            return _regeneratorRuntime.async(function _callee2$(_context6) {\n              while (1) {\n                switch (_context6.prev = _context6.next) {\n                  case 0:\n                    _context6.next = 2;\n                    return _regeneratorRuntime.awrap(newFormUser(item.id, item.nome));\n\n                  case 2:\n                  case \"end\":\n                    return _context6.stop();\n                }\n              }\n            }, null, null, null, Promise);\n          })));\n\n        case 11:\n          _context7.next = 17;\n          break;\n\n        case 13:\n          _context7.prev = 13;\n          _context7.t0 = _context7[\"catch\"](4);\n          console.log(_context7.t0);\n          return _context7.abrupt(\"return\", {\n            message: constants.syncErrorMessage\n          });\n\n        case 17:\n          return _context7.abrupt(\"return\", {});\n\n        case 18:\n        case \"end\":\n          return _context7.stop();\n      }\n    }\n  }, null, null, [[4, 13]], Promise);\n};\nexport var queryFormUsers = function queryFormUsers(text) {\n  var toReturn, query;\n  return _regeneratorRuntime.async(function queryFormUsers$(_context8) {\n    while (1) {\n      switch (_context8.prev = _context8.next) {\n        case 0:\n          toReturn = [];\n          _context8.prev = 1;\n\n          if (!(text && text.length > 2)) {\n            _context8.next = 7;\n            break;\n          }\n\n          _context8.next = 5;\n          return _regeneratorRuntime.awrap(selectFormUsers(text));\n\n        case 5:\n          query = _context8.sent;\n          toReturn = query.slice(0, 5);\n\n        case 7:\n          _context8.next = 12;\n          break;\n\n        case 9:\n          _context8.prev = 9;\n          _context8.t0 = _context8[\"catch\"](1);\n          console.log(_context8.t0);\n\n        case 12:\n          return _context8.abrupt(\"return\", toReturn);\n\n        case 13:\n        case \"end\":\n          return _context8.stop();\n      }\n    }\n  }, null, null, [[1, 9]], Promise);\n};\nexport var syncWeather = function syncWeather() {\n  var idLastWeatherApi, requestJSON, response;\n  return _regeneratorRuntime.async(function syncWeather$(_context10) {\n    while (1) {\n      switch (_context10.prev = _context10.next) {\n        case 0:\n          _context10.next = 2;\n          return _regeneratorRuntime.awrap(selectLastWeather());\n\n        case 2:\n          idLastWeatherApi = _context10.sent;\n          requestJSON = {\n            idLastWeatherApi: idLastWeatherApi\n          };\n          _context10.prev = 4;\n          _context10.next = 7;\n          return _regeneratorRuntime.awrap(httpRequest(requestJSON, constants.routes.consultaTempo));\n\n        case 7:\n          response = _context10.sent;\n\n          if (!response.data) {\n            _context10.next = 11;\n            break;\n          }\n\n          _context10.next = 11;\n          return _regeneratorRuntime.awrap(Promise.all(response.data.map(function _callee3(item) {\n            return _regeneratorRuntime.async(function _callee3$(_context9) {\n              while (1) {\n                switch (_context9.prev = _context9.next) {\n                  case 0:\n                    _context9.next = 2;\n                    return _regeneratorRuntime.awrap(newWeather(item.id, item.nome));\n\n                  case 2:\n                  case \"end\":\n                    return _context9.stop();\n                }\n              }\n            }, null, null, null, Promise);\n          })));\n\n        case 11:\n          _context10.next = 17;\n          break;\n\n        case 13:\n          _context10.prev = 13;\n          _context10.t0 = _context10[\"catch\"](4);\n          console.log(_context10.t0);\n          return _context10.abrupt(\"return\", {\n            message: constants.syncErrorMessage\n          });\n\n        case 17:\n          return _context10.abrupt(\"return\", {});\n\n        case 18:\n        case \"end\":\n          return _context10.stop();\n      }\n    }\n  }, null, null, [[4, 13]], Promise);\n};\nexport var getWeather = function getWeather() {\n  var toReturn;\n  return _regeneratorRuntime.async(function getWeather$(_context11) {\n    while (1) {\n      switch (_context11.prev = _context11.next) {\n        case 0:\n          toReturn = [];\n          _context11.prev = 1;\n          _context11.next = 4;\n          return _regeneratorRuntime.awrap(selectWeather());\n\n        case 4:\n          toReturn = _context11.sent;\n          _context11.next = 10;\n          break;\n\n        case 7:\n          _context11.prev = 7;\n          _context11.t0 = _context11[\"catch\"](1);\n          console.log(_context11.t0);\n\n        case 10:\n          return _context11.abrupt(\"return\", toReturn);\n\n        case 11:\n        case \"end\":\n          return _context11.stop();\n      }\n    }\n  }, null, null, [[1, 7]], Promise);\n};\nexport var syncRestrictionReason = function syncRestrictionReason() {\n  var idLastRestrictionReasonApi, requestJSON, response;\n  return _regeneratorRuntime.async(function syncRestrictionReason$(_context13) {\n    while (1) {\n      switch (_context13.prev = _context13.next) {\n        case 0:\n          _context13.next = 2;\n          return _regeneratorRuntime.awrap(selectLastRestrictionReason());\n\n        case 2:\n          idLastRestrictionReasonApi = _context13.sent;\n          requestJSON = {\n            idLastRestrictionReasonApi: idLastRestrictionReasonApi\n          };\n          _context13.prev = 4;\n          _context13.next = 7;\n          return _regeneratorRuntime.awrap(httpRequest(requestJSON, constants.routes.consultaMotivoRestricao));\n\n        case 7:\n          response = _context13.sent;\n\n          if (!response.data) {\n            _context13.next = 11;\n            break;\n          }\n\n          _context13.next = 11;\n          return _regeneratorRuntime.awrap(Promise.all(response.data.map(function _callee4(item) {\n            return _regeneratorRuntime.async(function _callee4$(_context12) {\n              while (1) {\n                switch (_context12.prev = _context12.next) {\n                  case 0:\n                    _context12.next = 2;\n                    return _regeneratorRuntime.awrap(newRestrictionReason(item.id, item.desc));\n\n                  case 2:\n                  case \"end\":\n                    return _context12.stop();\n                }\n              }\n            }, null, null, null, Promise);\n          })));\n\n        case 11:\n          _context13.next = 17;\n          break;\n\n        case 13:\n          _context13.prev = 13;\n          _context13.t0 = _context13[\"catch\"](4);\n          console.log(_context13.t0);\n          return _context13.abrupt(\"return\", {\n            message: constants.syncErrorMessage\n          });\n\n        case 17:\n          return _context13.abrupt(\"return\", {});\n\n        case 18:\n        case \"end\":\n          return _context13.stop();\n      }\n    }\n  }, null, null, [[4, 13]], Promise);\n};\nexport var getRestrictionReason = function getRestrictionReason() {\n  var toReturn;\n  return _regeneratorRuntime.async(function getRestrictionReason$(_context14) {\n    while (1) {\n      switch (_context14.prev = _context14.next) {\n        case 0:\n          toReturn = [];\n          _context14.prev = 1;\n          _context14.next = 4;\n          return _regeneratorRuntime.awrap(selectRestrictionReason());\n\n        case 4:\n          toReturn = _context14.sent;\n          _context14.next = 10;\n          break;\n\n        case 7:\n          _context14.prev = 7;\n          _context14.t0 = _context14[\"catch\"](1);\n          console.log(_context14.t0);\n\n        case 10:\n          return _context14.abrupt(\"return\", toReturn);\n\n        case 11:\n        case \"end\":\n          return _context14.stop();\n      }\n    }\n  }, null, null, [[1, 7]], Promise);\n};\nvar albumName = 'LOGS_APP_SGO';\nvar assetList = [];\nvar albumList = [];\nexport var gravarLogLocal = function gravarLogLocal(text) {\n  var permission, fileUri, fileText;\n  return _regeneratorRuntime.async(function gravarLogLocal$(_context15) {\n    while (1) {\n      switch (_context15.prev = _context15.next) {\n        case 0:\n          _context15.next = 2;\n          return _regeneratorRuntime.awrap(MediaLibrary.requestPermissionsAsync());\n\n        case 2:\n          permission = _context15.sent;\n\n          if (!permission.granted) {\n            _context15.next = 14;\n            break;\n          }\n\n          fileUri = FileSystem.documentDirectory + 'Log_SGO.txt';\n          _context15.next = 7;\n          return _regeneratorRuntime.awrap(readFile(fileUri));\n\n        case 7:\n          fileText = _context15.sent;\n\n          if (!fileText) {\n            _context15.next = 12;\n            break;\n          }\n\n          text += '\\n' + fileText;\n          _context15.next = 12;\n          return _regeneratorRuntime.awrap(deleteFile(fileUri));\n\n        case 12:\n          _context15.next = 14;\n          return _regeneratorRuntime.awrap(writeFile(fileUri, text));\n\n        case 14:\n        case \"end\":\n          return _context15.stop();\n      }\n    }\n  }, null, null, null, Promise);\n};\n\nvar readFile = function readFile(uri) {\n  var toReturn, assetId, albumId;\n  return _regeneratorRuntime.async(function readFile$(_context16) {\n    while (1) {\n      switch (_context16.prev = _context16.next) {\n        case 0:\n          toReturn = null;\n          _context16.prev = 1;\n          _context16.next = 4;\n          return _regeneratorRuntime.awrap(FileSystem.readAsStringAsync(uri, FileSystem.UTF8));\n\n        case 4:\n          toReturn = _context16.sent;\n          _context16.next = 7;\n          return _regeneratorRuntime.awrap(getAssetId());\n\n        case 7:\n          assetId = _context16.sent;\n\n          if (assetId) {\n            assetList.push(assetId);\n          }\n\n          _context16.next = 11;\n          return _regeneratorRuntime.awrap(getAlbumId());\n\n        case 11:\n          albumId = _context16.sent;\n\n          if (albumId) {\n            albumList.push(albumId);\n          }\n\n          _context16.next = 18;\n          break;\n\n        case 15:\n          _context16.prev = 15;\n          _context16.t0 = _context16[\"catch\"](1);\n          console.log(_context16.t0);\n\n        case 18:\n          return _context16.abrupt(\"return\", toReturn);\n\n        case 19:\n        case \"end\":\n          return _context16.stop();\n      }\n    }\n  }, null, null, [[1, 15]], Promise);\n};\n\nvar writeFile = function writeFile(uri, text) {\n  var asset, album;\n  return _regeneratorRuntime.async(function writeFile$(_context17) {\n    while (1) {\n      switch (_context17.prev = _context17.next) {\n        case 0:\n          _context17.prev = 0;\n          _context17.next = 3;\n          return _regeneratorRuntime.awrap(FileSystem.writeAsStringAsync(uri, text, {\n            encoding: FileSystem.EncodingType.UTF8\n          }));\n\n        case 3:\n          _context17.next = 5;\n          return _regeneratorRuntime.awrap(MediaLibrary.createAssetAsync(uri));\n\n        case 5:\n          asset = _context17.sent;\n          _context17.next = 8;\n          return _regeneratorRuntime.awrap(MediaLibrary.createAlbumAsync(albumName, asset, true));\n\n        case 8:\n          album = _context17.sent;\n          assetList.push(asset.id);\n          albumList.push(album.id);\n          _context17.next = 13;\n          return _regeneratorRuntime.awrap(setAssetId(asset.id));\n\n        case 13:\n          _context17.next = 15;\n          return _regeneratorRuntime.awrap(setAlbumId(album.id));\n\n        case 15:\n          _context17.next = 20;\n          break;\n\n        case 17:\n          _context17.prev = 17;\n          _context17.t0 = _context17[\"catch\"](0);\n          console.log(_context17.t0);\n\n        case 20:\n        case \"end\":\n          return _context17.stop();\n      }\n    }\n  }, null, null, [[0, 17]], Promise);\n};\n\nvar deleteFile = function deleteFile(uri) {\n  return _regeneratorRuntime.async(function deleteFile$(_context18) {\n    while (1) {\n      switch (_context18.prev = _context18.next) {\n        case 0:\n          _context18.prev = 0;\n          _context18.next = 3;\n          return _regeneratorRuntime.awrap(FileSystem.deleteAsync(uri));\n\n        case 3:\n          _context18.next = 5;\n          return _regeneratorRuntime.awrap(MediaLibrary.deleteAssetsAsync(assetList));\n\n        case 5:\n          _context18.next = 7;\n          return _regeneratorRuntime.awrap(MediaLibrary.deleteAlbumsAsync(albumList, true));\n\n        case 7:\n          assetList.length = 0;\n          albumList.length = 0;\n          _context18.next = 14;\n          break;\n\n        case 11:\n          _context18.prev = 11;\n          _context18.t0 = _context18[\"catch\"](0);\n          console.log(_context18.t0);\n\n        case 14:\n        case \"end\":\n          return _context18.stop();\n      }\n    }\n  }, null, null, [[0, 11]], Promise);\n};\n\nexport var getCurrentDate = function getCurrentDate() {\n  var data = new Date();\n  var dia = data.getDate();\n  var dia_sem = data.getDay();\n  var mes = data.getMonth();\n  var ano2 = data.getYear();\n  var ano4 = data.getFullYear();\n  var hora = data.getHours();\n  var min = data.getMinutes();\n  var seg = data.getSeconds();\n  var mseg = data.getMilliseconds();\n  var tz = data.getTimezoneOffset();\n  var str_data = dia + '/' + (mes + 1) + '/' + ano4;\n  var str_hora = hora + ':' + min + ':' + seg;\n  return str_data + ' às ' + str_hora;\n};","map":{"version":3,"sources":["C:/RepositorioAPPSGO/APP-main/businessLayer/forms.js"],"names":["React","useState","httpRequest","constants","Permissions","MediaLibrary","FileSystem","getAssetId","setAssetId","getAlbumId","setAlbumId","newForm","deleteForm","selectForms","selectLastFormUser","newFormUser","selectFormUsers","getFormByRoute","deleteFormByRoute","selectLastWeather","newWeather","selectWeather","selectLastRestrictionReason","newRestrictionReason","selectRestrictionReason","UserContext","ButtonP","Message","SendForm","props","context","useContext","undefined","message","setMessage","sendFormApp","callback","requiredField","req","json","send","route","userId","createdForm","response","responseDataString","data","console","log","msgRetornoSincronizacao","timeoutMessage","notConnectedMessage","includes","gravarLogLocal","getCurrentDate","alert","width","marginVertical","marginTop","alignItems","title","idBoletim","JSON","stringify","stringJSON","persistForm","warn","errorMessage","syncApp","totalForms","syncForms","dbForms","Promise","all","map","item","parse","jsonObject","id","syncErrorMessage","updateForms","toReturn","forms","length","syncFormUsers","idLastUserApi","requestJSON","routes","consultaUsuarios","nome","queryFormUsers","text","query","slice","syncWeather","idLastWeatherApi","consultaTempo","getWeather","syncRestrictionReason","idLastRestrictionReasonApi","consultaMotivoRestricao","desc","getRestrictionReason","albumName","assetList","albumList","requestPermissionsAsync","permission","granted","fileUri","documentDirectory","readFile","fileText","deleteFile","writeFile","uri","readAsStringAsync","UTF8","assetId","push","albumId","writeAsStringAsync","encoding","EncodingType","createAssetAsync","asset","createAlbumAsync","album","deleteAsync","deleteAssetsAsync","deleteAlbumsAsync","Date","dia","getDate","dia_sem","getDay","mes","getMonth","ano2","getYear","ano4","getFullYear","hora","getHours","min","getMinutes","seg","getSeconds","mseg","getMilliseconds","tz","getTimezoneOffset","str_data","str_hora"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\nimport { View } from 'react-native';\nimport { httpRequest } from '../utils/apiUtils';\nimport * as constants from '../utils/constants';\nimport * as Permissions from 'expo-permissions';\nimport * as MediaLibrary from 'expo-media-library';\nimport * as FileSystem from 'expo-file-system';\nimport { getAssetId, setAssetId, getAlbumId, setAlbumId } from '../db/sqliteConnection';\nimport {\n\tnewForm,\n\tdeleteForm,\n\tselectForms,\n\tselectLastFormUser,\n\tnewFormUser,\n\tselectFormUsers,\n\tgetFormByRoute,\n\tdeleteFormByRoute,\n\tselectLastWeather,\n\tnewWeather,\n\tselectWeather,\n\tselectLastRestrictionReason,\n\tnewRestrictionReason,\n\tselectRestrictionReason\n} from '../db/forms';\nimport { UserContext } from './login';\nimport { ButtonP } from '../components/Button';\nimport { Message } from '../components/AnimatedMessage';\n\nexport function SendForm(props) {\n\tconst context = React.useContext(UserContext);\n\tconst [message, setMessage] = useState(undefined);\n\tconst sendFormApp = async (callback) => {\n\n\t\tconst requiredField = props.req(props.json);\n\n\t\tif (requiredField == \"\") {\n\t\t\tconst response = await send(props.json, props.route, context.userId, props.createdForm);\n\t\t\t//Mensagem retornada em string\n\t\t\tvar responseDataString = response.data;\n\t\t\tconsole.log(\"1:\" + responseDataString);\n\t\t\t//Mensagem padrão\n\t\t\tvar msgRetornoSincronizacao = \"Formulário salvo, porém, não sincronizado.\";\n\n\t\t\t//Caso obtenha sucesso na comunicação\n\t\t\tif (response.message == constants.timeoutMessage ||\n\t\t\t\tresponse.message == constants.notConnectedMessage ||\n\t\t\t\tresponse.data) {\n\t\t\t\t\tconsole.log(\"2:\" + responseDataString);\n\t\t\t\t\tconsole.log(typeof responseDataString.includes === \"undefined\");\n\n\t\t\t\t\tif(responseDataString != true && responseDataString != false){\n\t\t\t\t\t\tif (responseDataString.includes('sucesso')) {\n\t\t\t\t\t\t\tawait deleteFormByRoute(props.route);\n\t\t\t\t\t\t\tmsgRetornoSincronizacao = responseDataString + \" Boletim sincronizado com sucesso!\";\n\t\t\t\t\t\t\tawait gravarLogLocal(getCurrentDate() + \" - \" + msgRetornoSincronizacao);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\n\n\t\t\t\tprops.callback();\n\t\t\t} else {\n\n\t\t\n\t\t\t\t//Não houve sucesso ao sincronizar por conta de alguma crítica da API\n\t\t\t\tmsgRetornoSincronizacao = \"\";\n\t\t\t\tawait gravarLogLocal(getCurrentDate() + \" - \" +  response.message);\n\t\t\t\tsetMessage(response.message);\n\t\t\t\t\n\n\n\t\t\t}\n\t\t} else {\n\t\t\t\n\t\t\tsetMessage(requiredField);\n\t\t}\n\n\t\tif (msgRetornoSincronizacao != \"\" && msgRetornoSincronizacao != undefined) {\n\t\t\tawait gravarLogLocal(getCurrentDate() + \" - \" + msgRetornoSincronizacao);\n\t\t\talert(msgRetornoSincronizacao);\n\t\t}\n\t\tcallback();\n\t}\n\n\treturn (\n\t\t<View>\n\t\t\t<View style={{ width: 400, marginVertical: 20, marginTop: 20, alignItems: 'center', width: '100%' }}>\n\t\t\t\t<ButtonP title={props.title} onPress={sendFormApp} />\n\t\t\t</View>\n\t\t\t<Message message={message} callback={() => setMessage(undefined)} />\n\t\t</View>\n\t);\n}\n\nexport const send = async (json, route, userId, createdForm) => {\n\ttry {\n\t\tif (userId && json.idBoletim != '') {\n\n\t\t\tjson.userId = userId;\n\t\t\tconst response = await httpRequest(json, route);\n\t\t\tif (response.data && !createdForm) {\n\t\t\t\t//await deleteFormByRoute(route);\n\n\t\t\t}\n\t\t\tif (response.message == constants.timeoutMessage ||\n\t\t\t\tresponse.message == constants.notConnectedMessage) {\n\t\t\t\tconst stringJSON = await JSON.stringify(json);\n\t\t\t\tconst persistForm = await newForm(stringJSON, route, createdForm);\n\t\t\t}\n\t\t\tconsole.warn(response);\n\t\t\treturn response;\n\t\t} else {\n\t\t\tconst stringJSON = await JSON.stringify(json);\n\t\t\tconst persistForm = await newForm(stringJSON, route, createdForm);\n\t\t\treturn { data: persistForm };\n\t\t}\n\t} catch (error) {\n\t\tconsole.log(error);\n\t\treturn { message: constants.errorMessage };\n\t}\n}\n\nexport const syncApp = async (userId) => {\n\ttry {\n\t\tlet totalForms = 0;\n\t\tlet syncForms = 0;\n\t\tif (userId) {\n\t\t\tconst dbForms = await selectForms();\n\t\t\tawait Promise.all(dbForms.map(async (item) => {\n\t\t\t\tconst jsonObject = await JSON.parse(item.stringJSON);\n\t\t\t\tif (jsonObject.idBoletim != '') {\n\t\t\t\t\tjsonObject.userId = userId;\n\t\t\t\t\tconst response = await httpRequest(jsonObject, item.route);\n\t\t\t\t\tif (response.data) {\n\t\t\t\t\t\tdeleteForm(item.id);\n\t\t\t\t\t\tsyncForms += 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\ttotalForms += 1;\n\t\t\t}));\n\t\t\treturn { message: syncForms + \" de \" + totalForms + \" formulários sincronizados\" }\n\n\t\t}\n\t} catch (error) {\n\t\tconsole.log(error);\n\t\treturn { message: constants.syncErrorMessage };\n\t}\n}\n\n\n\nexport const updateForms = async (route) => {\n\tlet toReturn = null;\n\n\tconst forms = await getFormByRoute(route);\n\tif (forms.length > 0) {\n\t\ttoReturn = JSON.parse(forms[0].stringJSON);\n\t}\n\n\treturn toReturn;\n}\n\nexport const syncFormUsers = async () => {\n\tconst idLastUserApi = await selectLastFormUser();\n\tconst requestJSON = {\n\t\tidLastUserApi: idLastUserApi\n\t}\n\ttry {\n\t\tconst response = await httpRequest(requestJSON, constants.routes.consultaUsuarios);\n\t\tif (response.data) {\n\t\t\tawait Promise.all(response.data.map(async (item) => {\n\t\t\t\tawait newFormUser(item.id, item.nome);\n\t\t\t}));\n\t\t}\n\t} catch (error) {\n\t\tconsole.log(error);\n\t\treturn { message: constants.syncErrorMessage };\n\t}\n\n\treturn {};\n}\n\nexport const queryFormUsers = async (text) => {\n\tlet toReturn = [];\n\ttry {\n\t\tif (text && text.length > 2) {\n\t\t\tconst query = await selectFormUsers(text);\n\t\t\ttoReturn = query.slice(0, 5);\n\t\t}\n\t} catch (error) {\n\t\tconsole.log(error);\n\t}\n\treturn toReturn;\n}\n\nexport const syncWeather = async () => {\n\tconst idLastWeatherApi = await selectLastWeather();\n\tconst requestJSON = {\n\t\tidLastWeatherApi: idLastWeatherApi\n\t}\n\n\ttry {\n\t\tconst response = await httpRequest(requestJSON, constants.routes.consultaTempo);\n\t\tif (response.data) {\n\t\t\tawait Promise.all(response.data.map(async (item) => {\n\t\t\t\tawait newWeather(item.id, item.nome);\n\t\t\t}));\n\t\t}\n\t} catch (error) {\n\t\tconsole.log(error);\n\t\treturn { message: constants.syncErrorMessage };\n\t}\n\n\treturn {};\n}\n\nexport const getWeather = async () => {\n\tlet toReturn = [];\n\ttry {\n\t\ttoReturn = await selectWeather();\n\t} catch (error) {\n\t\tconsole.log(error);\n\t}\n\treturn toReturn;\n}\n\nexport const syncRestrictionReason = async () => {\n\tconst idLastRestrictionReasonApi = await selectLastRestrictionReason();\n\tconst requestJSON = {\n\t\tidLastRestrictionReasonApi: idLastRestrictionReasonApi\n\t}\n\n\ttry {\n\t\tconst response = await httpRequest(requestJSON, constants.routes.consultaMotivoRestricao);\n\t\tif (response.data) {\n\t\t\tawait Promise.all(response.data.map(async (item) => {\n\t\t\t\tawait newRestrictionReason(item.id, item.desc);\n\t\t\t}));\n\t\t}\n\t} catch (error) {\n\t\tconsole.log(error);\n\t\treturn { message: constants.syncErrorMessage };\n\t}\n\n\treturn {};\n}\n\nexport const getRestrictionReason = async () => {\n\tlet toReturn = [];\n\ttry {\n\t\ttoReturn = await selectRestrictionReason();\n\t} catch (error) {\n\t\tconsole.log(error);\n\t}\n\treturn toReturn;\n}\n\n\n\n\nconst albumName = 'LOGS_APP_SGO';\nconst assetList = [];\nconst albumList = [];\n\n\n\n\nexport const gravarLogLocal = async (text) => {\n    //Pode ser substituida pela permission, minha versão deu deprecated então usei o do medialibrary\n    const permission = await MediaLibrary.requestPermissionsAsync();\n  \n    if (permission.granted) {\n        const fileUri = FileSystem.documentDirectory + 'Log_SGO.txt';\n        const fileText = await readFile(fileUri);\n        if(fileText){\n            text += '\\n' + fileText;\n            await deleteFile(fileUri);\n        }\n        await writeFile(fileUri, text);\n    }\n  }\n\n\n\nconst readFile = async (uri) => {\n  let toReturn = null;\n  try {\n    toReturn = await FileSystem.readAsStringAsync(uri, FileSystem.UTF8);\n    const assetId = await getAssetId();\n    if (assetId) {\n      assetList.push(assetId);\n    }\n    const albumId = await getAlbumId();\n    if(albumId){\n        albumList.push(albumId);\n    }\n  } catch (error) {\n    console.log(error);\n  }\n  return toReturn;\n}\n\nconst writeFile = async (uri, text) => {\n  try {\n    await FileSystem.writeAsStringAsync(uri, text, { encoding: FileSystem.EncodingType.UTF8 });\n    const asset = await MediaLibrary.createAssetAsync(uri);\n    const album = await MediaLibrary.createAlbumAsync(albumName, asset, true);\n    assetList.push(asset.id);\n    albumList.push(album.id);\n    await setAssetId(asset.id);\n    await setAlbumId(album.id);\n  } catch (error) {\n    console.log(error);\n  }\n}\n\nconst deleteFile = async (uri) => {\n    try {\n      await FileSystem.deleteAsync(uri);\n      await MediaLibrary.deleteAssetsAsync(assetList);\n      await MediaLibrary.deleteAlbumsAsync(albumList, true);\n      assetList.length = 0;\n      albumList.length = 0;\n    } catch (error) {\n      console.log(error);\n    }\n  }\n\nexport const getCurrentDate=()=>{\n\n\t\n// Obtém a data/hora atual\nvar data = new Date();\n\n// Guarda cada pedaço em uma variável\nvar dia     = data.getDate();           // 1-31\nvar dia_sem = data.getDay();            // 0-6 (zero=domingo)\nvar mes     = data.getMonth();          // 0-11 (zero=janeiro)\nvar ano2    = data.getYear();           // 2 dígitos\nvar ano4    = data.getFullYear();       // 4 dígitos\nvar hora    = data.getHours();          // 0-23\nvar min     = data.getMinutes();        // 0-59\nvar seg     = data.getSeconds();        // 0-59\nvar mseg    = data.getMilliseconds();   // 0-999\nvar tz      = data.getTimezoneOffset(); // em minutos\n\n// Formata a data e a hora (note o mês + 1)\nvar str_data = dia + '/' + (mes+1) + '/' + ano4;\nvar str_hora = hora + ':' + min + ':' + seg;\n\n//  o resultado\nreturn str_data + ' às ' + str_hora;\n}"]},"metadata":{},"sourceType":"module"}